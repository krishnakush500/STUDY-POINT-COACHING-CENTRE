<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Exam Results - STUDY POINT COACHING CENTRE</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
  
  <!-- html2pdf library for PDF generation -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  
  <style>
    * { margin:0; padding:0; box-sizing:border-box; font-family:'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
    body { background:#f5f5f5; min-height:100vh; padding:20px; }
    
    /* Header */
    .header { 
      background:linear-gradient(to right,#1a237e,#283593,#303f9f); 
      color:white; 
      padding:25px; 
      text-align:center; 
      position:relative; 
      overflow:hidden; 
      border-radius:15px 15px 0 0;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 0 auto;
      box-shadow:0 15px 30px rgba(0,0,0,0.2);
    }
    .school-name { font-size:2rem; font-weight:700; line-height:1.2; }
    .location { font-size:1rem; margin-bottom:15px; }
    .director-info { display:flex; align-items:center; justify-content:center; margin-top:20px; flex-wrap:wrap; }
    .director-photo { 
      width:100px; 
      height:100px; 
      border-radius:50%; 
      border:4px solid white; 
      overflow:hidden; 
      margin-right:15px; 
      cursor: pointer;
      transition: transform 0.3s;
    }
    .director-photo:hover {
      transform: scale(1.05);
    }
    .director-photo img{width:100%;height:100%;object-fit:cover;}
    .director-details{text-align:left;}
    .director-details h2{font-size:1rem; margin-bottom:5px;}
    .director-details h3{font-size:1.1rem; margin-bottom:5px;}
    .director-details p{font-size:0.9rem;}

    /* Moving Admission Text */
    .marquee-container {
      background:#ffc107;
      overflow:hidden;
      position:relative;
      height:50px;
      display:flex;
      align-items:center;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 0 auto;
    }
    .marquee-content {
      display:flex;
      animation: marquee 20s linear infinite;
      white-space:nowrap;
      font-weight:600;
      font-size:1.1rem;
      color:#333;
    }
    @keyframes marquee {
      0% { transform: translateX(100%); }
      100% { transform: translateX(-100%); }
    }

    /* Results Section */
    .results-section { 
      padding:20px; 
      background:#f9f9f9; 
      width: 100%;
      max-width: 1200px;
      margin: 0 auto 0 auto;
      border-radius: 0 0 15px 15px;
      box-shadow:0 15px 30px rgba(0,0,0,0.2);
    }
    .section-title { font-size:1.5rem; color:#1a237e; text-align:center; margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid #1a237e; }
    
    .results-list { display:grid; grid-template-columns:repeat(auto-fill, minmax(280px, 1fr)); gap:15px; margin-bottom:25px; }
    .result-item { background:white; padding:15px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); cursor:pointer; transition:all 0.3s; border-left:4px solid #1a237e; position:relative; }
    .result-item:hover { transform:translateY(-5px); box-shadow:0 8px 20px rgba(0,0,0,0.15); }
    .result-item.active { border-left-color:#ffc107; background:#fffae6; }
    .exam-name { font-size:1rem; color:#1a237e; font-weight:600; margin-bottom:8px; }
    .exam-date { font-size:0.8rem; color:#666; margin-bottom:5px; }
    
    /* NEW Sticker */
    .new-sticker {
      position:absolute;
      top:-8px;
      right:-8px;
      background:#ff4757;
      color:white;
      font-size:0.7rem;
      font-weight:bold;
      padding:4px 8px;
      border-radius:10px;
      animation: blink 1s infinite;
      z-index:10;
    }
    @keyframes blink {
      0%, 100% { opacity:1; }
      50% { opacity:0.7; }
    }
    
    .roll-input-section { background:white; padding:20px; border-radius:10px; box-shadow:0 5px 15px rgba(0,0,0,0.1); margin-top:20px; text-align:center; display:none; }
    .roll-input-section h3 { color:#1a237e; margin-bottom:15px; font-size:1.1rem; }
    .input-group { display:flex; justify-content:center; gap:8px; flex-wrap:wrap; }
    .input-group input { padding:10px 12px; font-size:0.95rem; border-radius:5px; border:1px solid #ccc; width:100%; max-width:250px; }
    .result-btn { padding:10px 20px; background:#1a237e; color:white; font-size:0.95rem; border:none; border-radius:8px; cursor:pointer; transition:background 0.3s; }
    .result-btn:hover { background:#283593; }
    
    /* Result Card - Mobile Optimized */
    .result-card { display:none; width:95%; max-width:700px; margin:20px auto; background:white; border-radius:15px; box-shadow:0 10px 30px rgba(0,0,0,0.2); padding:20px; position:relative; overflow-x:auto; }
    .result-card-header { text-align:center; margin-bottom:20px; padding-bottom:10px; border-bottom:2px solid #1a237e; }
    .result-card-header h2 { color:#1a237e; margin-bottom:5px; font-size:1.3rem; }
    .result-card-header h3 { color:#b21f1f; margin-bottom:5px; font-size:1.1rem; }
    .result-card-header p { color:#666; font-size:0.85rem; }
    
    .student-info { margin-bottom:20px; }
    .info-row { display:flex; flex-direction:column; margin-bottom:8px; padding:8px 12px; background:#f5f5f5; border-radius:5px; }
    .info-label { font-weight:600; color:#1a237e; font-size:0.9rem; margin-bottom:3px; }
    .info-value { color:#333; font-size:0.95rem; }
    
    .marks-table { width:100%; border-collapse:collapse; margin-bottom:20px; min-width:500px; }
    .marks-table th { background:#1a237e; color:white; padding:10px; text-align:left; font-size:0.9rem; }
    .marks-table td { padding:10px; border-bottom:1px solid #ddd; font-size:0.9rem; }
    .marks-table tr:nth-child(even) { background:#f9f9f9; }
    .marks-table tr:hover { background:#f0f0f0; }
    
    .total-marks { background:#e8f5e8 !important; font-weight:600; color:#1a237e; }
    .percentage-display { text-align:center; font-size:1.2rem; color:#1a237e; font-weight:700; padding:12px; background:#f0f7ff; border-radius:10px; margin-top:15px; }
    .division-display { text-align:center; font-size:1.4rem; color:#1a237e; font-weight:700; padding:12px; margin-top:12px; border-radius:10px; }
    .coaching-mention { text-align:center; margin-top:15px; padding-top:12px; border-top:1px solid #ddd; color:#666; font-style:italic; font-size:0.9rem; }
    
    .action-buttons { display:flex; justify-content:center; gap:10px; margin-top:20px; padding-top:15px; border-top:1px solid #ddd; flex-wrap:wrap; }
    .action-buttons button { padding:10px 15px; font-size:0.9rem; border:none; border-radius:8px; cursor:pointer; transition:all 0.3s; display:flex; align-items:center; gap:5px; }
    .download-btn { background:#28a745; color:white; }
    .download-btn:hover { background:#218838; }
    .back-btn { background:#6c757d; color:white; }
    .back-btn:hover { background:#5a6268; }
    
    .loading { text-align:center; padding:20px; font-size:1rem; color:#1a237e; }
    .error { text-align:center; padding:15px; background:#ffe6e6; color:#b30000; border-radius:5px; margin:15px 0; }
    
    /* Coaching Promotion Section */
    .promotion-section {
      padding: 20px;
      background: linear-gradient(135deg, #f5f7fa 0%, #e4e8f0 100%);
      margin: 20px auto;
      border-radius: 10px;
      border-left: 5px solid #1a237e;
      width: 100%;
      max-width: 1200px;
    }
    .promotion-section h3 {
      color: #1a237e;
      text-align: center;
      margin-bottom: 15px;
      font-size: 1.5rem;
    }
    .about-list {
      font-size: 0.95rem;
      line-height: 1.6;
      color: #333;
      padding: 0 10px;
      list-style-type: decimal;
      margin-left: 20px;
    }
    .about-list li {
      margin-bottom: 10px;
      padding-left: 5px;
    }
    .promo-highlight {
      color: #b21f1f;
      font-weight: 600;
    }
    
    /* Motivational Shayari Section */
    .shayari-section {
      padding: 25px 20px;
      background: #f8f9fa;
      margin: 20px auto;
      border-radius: 10px;
      border-top: 3px solid #1a237e;
      border-bottom: 3px solid #1a237e;
      width: 100%;
      max-width: 1200px;
    }
    .shayari-title {
      text-align: center;
      color: #1a237e;
      margin-bottom: 20px;
      font-size: 1.8rem;
      position: relative;
    }
    .shayari-title:after {
      content: '';
      position: absolute;
      width: 100px;
      height: 3px;
      background: #ffc107;
      bottom: -8px;
      left: 50%;
      transform: translateX(-50%);
    }
    .shayari-container {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }
    .shayari-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      border-left: 4px solid #1a237e;
      transition: transform 0.3s;
    }
    .shayari-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 8px 16px rgba(0,0,0,0.15);
    }
    .shayari-text {
      font-size: 1rem;
      line-height: 1.6;
      color: #333;
      font-style: italic;
      text-align: center;
      margin-bottom: 10px;
      min-height: 80px;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .shayari-author {
      text-align: center;
      color: #1a237e;
      font-weight: 600;
      font-size: 0.9rem;
      border-top: 1px dashed #ddd;
      padding-top: 10px;
      margin-top: 10px;
    }
    
    /* Footer */
    .footer { 
      background:#1a237e; 
      color:white; 
      text-align:center; 
      padding:15px; 
      font-size:0.9rem; 
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      border-radius: 0 0 15px 15px;
    }
    
    /* Developer Contact Section */
    .developer-contact {
      background: #f1f3f5;
      padding: 15px;
      text-align: center;
      border-top: 1px solid #ddd;
      margin: 20px auto 0 auto;
      font-size: 0.85rem;
      width: 100%;
      max-width: 1200px;
      border-radius: 10px;
    }
    .developer-contact h3 {
      color: #1a237e;
      margin-bottom: 10px;
      font-size: 1rem;
    }
    .developer-contact p {
      color: #555;
      margin-bottom: 8px;
      line-height: 1.4;
    }
    .contact-info {
      display: flex;
      justify-content: center;
      gap: 15px;
      flex-wrap: wrap;
      margin-top: 10px;
    }
    .contact-item {
      background: white;
      padding: 8px 15px;
      border-radius: 5px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      display: flex;
      align-items: center;
      gap: 5px;
    }
    .contact-item i {
      color: #1a237e;
      font-size: 0.9rem;
    }
    .contact-item span {
      font-size: 0.8rem;
    }
    
    /* Admin Password Modal */
    .admin-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.7);
      z-index: 10000;
      justify-content: center;
      align-items: center;
    }
    .modal-content {
      background: white;
      padding: 30px;
      border-radius: 10px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
      width: 90%;
      max-width: 400px;
      text-align: center;
    }
    .modal-content h3 {
      color: #1a237e;
      margin-bottom: 20px;
    }
    .modal-content input {
      width: 100%;
      padding: 12px;
      margin-bottom: 15px;
      border: 1px solid #ccc;
      border-radius: 5px;
      font-size: 1rem;
    }
    .modal-buttons {
      display: flex;
      gap: 10px;
      justify-content: center;
    }
    .modal-btn {
      padding: 10px 20px;
      border: none;
      border-radius: 5px;
      cursor: pointer;
      font-weight: 600;
    }
    .modal-btn.submit {
      background: #1a237e;
      color: white;
    }
    .modal-btn.cancel {
      background: #ccc;
      color: #333;
    }
    
    /* PDF Generation Fix Styles */
    .pdf-clone-container {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: white;
      z-index: 10000;
      overflow: auto;
      opacity: 0;
      pointer-events: none;
      visibility: hidden;
    }
    
    .pdf-clone {
      width: 100%;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
      background: white;
      box-shadow: 0 0 20px rgba(0,0,0,0.1);
    }
    
    /* Roll Number Hint */
    .roll-hint {
      margin-top: 15px;
      padding: 10px;
      background: #fff3cd;
      border-radius: 8px;
      border-left: 4px solid #ffc107;
      font-size: 0.85rem;
      color: #856404;
    }
    .roll-hint strong {
      color: #b21f1f;
    }
    
    /* Media Queries for Mobile */
    @media (max-width: 768px) {
      body { padding: 10px; }
      .school-name { font-size:1.6rem; }
      .header { padding:15px; }
      .director-info { flex-direction:column; text-align:center; }
      .director-photo { margin-right:0; margin-bottom:10px; }
      .director-details { text-align:center; }
      
      .results-list { grid-template-columns:1fr; }
      
      .marks-table { font-size:0.85rem; min-width:450px; }
      .marks-table th, .marks-table td { padding:8px; }
      
      .action-buttons { flex-direction:column; }
      .action-buttons button { width:100%; justify-content:center; }
      
      .about-list, .shayari-text { font-size:0.85rem; }
      
      /* Shayari section mobile */
      .shayari-container {
        grid-template-columns: 1fr;
      }
      
      /* Developer contact mobile */
      .contact-info {
        flex-direction: column;
        gap: 8px;
      }
      .contact-item {
        padding: 6px 12px;
      }
      
      /* Adjust PDF clone for mobile */
      .pdf-clone {
        padding: 15px;
        margin: 10px;
      }
    }
    
    @media (max-width: 480px) {
      .school-name { font-size:1.4rem; }
      .section-title { font-size:1.3rem; }
      .result-card { padding:15px; }
      .marks-table { min-width:350px; }
      .marks-table th, .marks-table td { padding:6px; font-size:0.8rem; }
      .shayari-title { font-size: 1.4rem; }
    }

  </style>
</head>
<body>
  <!-- Admin Password Modal -->
  <div class="admin-modal" id="admin-modal">
    <div class="modal-content">
      <h3>Admin Login</h3>
      <p>Enter password to access admin panel:</p>
      <input type="password" id="admin-password" placeholder="Enter password">
      <div class="modal-buttons">
        <button class="modal-btn submit" onclick="checkAdminPassword()">Submit</button>
        <button class="modal-btn cancel" onclick="closeAdminModal()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Header -->
  <div class="header">
    <h1 class="school-name">STUDY POINT COACHING CENTRE</h1>
    <p class="location">Muzaffarpur, Bihar</p>
    <div class="director-info">
      <div class="director-photo" onclick="openAdminModal()">
        <img src="https://i.ibb.co/Q39yS2T4/logo.jpg">
      </div>
      <div class="director-details">
        <h2>DIRECTOR</h2>
        <h3>GUDDU KUMAR</h3>
        <p><i class="fas fa-user-graduate"></i> B.Sc, B.Ed (CTET)</p>
        <p><i class="fas fa-phone"></i> Call: +91 6202608202</p>
      </div>
    </div>
  </div>

  <!-- Moving Notice Text -->
  <div class="marquee-container" id="notice-container">
    <div class="marquee-content" id="marquee-content">
      <!-- Notice content will be loaded from Firebase -->
    </div>
  </div>

  <!-- Results Section -->
  <div class="results-section">
    <h2 class="section-title">üìä Check Your Results</h2>
    
    <div class="loading" id="loading-results">
      <i class="fas fa-spinner fa-spin"></i> Loading available results from database...
    </div>
    
    <div class="results-list" id="results-list" style="display:none;"></div>
    
    <div class="roll-input-section" id="roll-input-section">
      <h3 id="selected-exam-name">Enter your Roll Number</h3>
      <div class="input-group">
        <input type="number" id="roll-input" placeholder="Enter Roll Number">
        <button class="result-btn" onclick="fetchStudentResult()">üìë Get Result</button>
        <button class="result-btn" onclick="goBackToResults()" style="background:#666;">‚¨Ö Back</button>
      </div>
      <!-- Roll Number Hint -->
      <div class="roll-hint">
        <strong>Note:</strong> Enter your roll number as provided by the coaching centre.
      </div>
    </div>
    
    <div class="result-card" id="result-card">
      <div class="result-card-header">
        <h2>STUDY POINT COACHING CENTRE, Muzaffarpur</h2>
        <h3 id="result-exam-name">Exam Name</h3>
        <p>Under the guidance of <strong>GUDDU KUMAR</strong> (B.Sc, B.Ed - CTET)</p>
      </div>
      
      <div class="student-info">
        <div class="info-row">
          <span class="info-label">Student Name:</span>
          <span class="info-value" id="result-student-name">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Father's Name:</span>
          <span class="info-value" id="result-father-name">-</span>
        </div>
        <div class="info-row">
          <span class="info-label">Roll Number:</span>
          <span class="info-value" id="result-roll-no">-</span>
        </div>
      </div>
      
      <table class="marks-table">
        <thead>
          <tr>
            <th>Subject</th>
            <th>Marks Obtained</th>
            <th>Total Marks</th>
            <th>Percentage</th>
          </tr>
        </thead>
        <tbody id="marks-table-body">
          <!-- Marks will be populated here -->
        </tbody>
      </table>
      
      <div class="percentage-display" id="total-percentage">
        Total Percentage: 0%
      </div>
      
      <div class="division-display" id="division-display">
        Division: -
      </div>
      
      <div class="coaching-mention">
        <p>This result is published by STUDY POINT COACHING CENTRE, Muzaffarpur | Director: GUDDU KUMAR (B.Sc, B.Ed - CTET)</p>
        <p>For any queries, contact: +91 6202608202</p>
      </div>
      
      <div class="action-buttons">
        <button class="download-btn" onclick="downloadResultAsPDF()">
          <i class="fas fa-download"></i> Download Result PDF
        </button>
        <button class="back-btn" onclick="goBackToResults()">
          <i class="fas fa-arrow-left"></i> Back to Results
        </button>
      </div>
    </div>
  </div>

  <!-- Coaching Promotion Section -->
  <div class="promotion-section">
    <h3>About Us</h3>
    <ol class="about-list" id="about-list">
      <!-- About lines will be loaded from Firebase -->
    </ol>
  </div>

  <!-- Motivational Shayari Section -->
  <div class="shayari-section">
    <h2 class="shayari-title">üí´ ‡§Æ‡•ã‡§ü‡§ø‡§µ‡•á‡§∂‡§®‡§≤ ‡§∂‡§æ‡§Ø‡§∞‡•Ä üí´</h2>
    <div class="shayari-container">
      <div class="shayari-card">
        <div class="shayari-text">‡§ú‡•ã ‡§ö‡§≤ ‡§™‡§°‡§º‡•á ‡§π‡•à‡§Ç ‡§Æ‡§Ç‡§ú‡§ø‡§≤ ‡§ï‡•Ä ‡§§‡§∞‡§´, ‡§â‡§®‡§ï‡•Ä ‡§∞‡§æ‡§π ‡§Ü‡§∏‡§æ‡§® ‡§π‡•ã ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à, ‡§•‡•ã‡§°‡§º‡§æ ‡§∏‡§Ç‡§ò‡§∞‡•ç‡§∑ ‡§ï‡§∞ ‡§≤‡•ã ‡§¶‡•ã‡§∏‡•ç‡§§‡•ã‡§Ç, ‡§´‡§ø‡§∞ ‡§ú‡§ø‡§Ç‡§¶‡§ó‡•Ä ‡§ñ‡•Å‡§∂‡§ø‡§Ø‡•ã‡§Ç ‡§∏‡•á ‡§≠‡§∞ ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§™‡§¢‡§º‡§æ‡§à ‡§ï‡•Ä ‡§∞‡§æ‡§π ‡§Æ‡•á‡§Ç ‡§Ü‡§è ‡§ú‡•ã ‡§≠‡•Ä ‡§∏‡§Ç‡§ï‡§ü, ‡§â‡§®‡§∏‡•á ‡§°‡§∞ ‡§ï‡§∞ ‡§®‡§æ ‡§π‡§æ‡§∞‡•ã ‡§ï‡§≠‡•Ä, ‡§π‡•å‡§∏‡§≤‡§æ ‡§¨‡•Å‡§≤‡§Ç‡§¶ ‡§∞‡§ñ‡•ã ‡§Ö‡§™‡§®‡§æ, ‡§∏‡§´‡§≤‡§§‡§æ ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•á ‡§ï‡§¶‡§Æ ‡§ö‡•Ç‡§Æ‡•á‡§ó‡•Ä‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§ï‡§ø‡§§‡§æ‡§¨‡•á‡§Ç ‡§π‡•à‡§Ç ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡•Ä ‡§∏‡§ö‡•ç‡§ö‡•Ä ‡§¶‡•ã‡§∏‡•ç‡§§, ‡§ú‡•ç‡§û‡§æ‡§® ‡§π‡•à ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡§æ ‡§π‡§•‡§ø‡§Ø‡§æ‡§∞, ‡§Ü‡§ú ‡§ï‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§π‡•Ä ‡§ï‡§≤ ‡§ï‡§æ, ‡§§‡•Å‡§Æ‡•ç‡§π‡§æ‡§∞‡§æ ‡§≠‡§µ‡§ø‡§∑‡•ç‡§Ø ‡§∏‡§Ç‡§µ‡§æ‡§∞‡•á‡§ó‡•Ä‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§∏‡•Å‡§¨‡§π ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§â‡§†‡§®‡•á ‡§µ‡§æ‡§≤‡•á ‡§ï‡•Ä, ‡§ï‡§ø‡§∏‡•ç‡§Æ‡§§ ‡§≠‡•Ä ‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§Æ‡•Å‡§∏‡•ç‡§ï‡•Å‡§∞‡§æ‡§§‡•Ä ‡§π‡•à, ‡§™‡§¢‡§º‡§æ‡§à ‡§Æ‡•á‡§Ç ‡§≤‡§ó‡§® ‡§∞‡§ñ‡•ã ‡§§‡•Å‡§Æ, ‡§∏‡§´‡§≤‡§§‡§æ ‡§∏‡•ç‡§µ‡§Ø‡§Ç ‡§ö‡§≤‡§ï‡§∞ ‡§Ü‡§§‡•Ä ‡§π‡•à‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§Ö‡§Ç‡§ß‡•á‡§∞‡§æ ‡§ö‡§æ‡§π‡•á ‡§ï‡§ø‡§§‡§®‡§æ ‡§≠‡•Ä ‡§ó‡§π‡§∞‡§æ ‡§π‡•ã, ‡§∏‡•Å‡§¨‡§π ‡§π‡•ã‡§ï‡§∞ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à, ‡§•‡•ã‡§°‡§º‡§æ ‡§î‡§∞ ‡§™‡•ç‡§∞‡§Ø‡§æ‡§∏ ‡§ï‡§∞ ‡§≤‡•ã, ‡§∏‡§´‡§≤‡§§‡§æ ‡§Æ‡§ø‡§≤‡§ï‡§∞ ‡§∞‡§π‡§§‡•Ä ‡§π‡•à‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§®‡§¶‡•Ä ‡§∞‡•Å‡§ï‡§§‡•Ä ‡§®‡§π‡•Ä‡§Ç ‡§ö‡§ü‡•ç‡§ü‡§æ‡§®‡•ã‡§Ç ‡§∏‡•á, ‡§ù‡§∞‡§®‡•á ‡§∞‡•Å‡§ï‡§§‡•á ‡§®‡§π‡•Ä‡§Ç ‡§™‡§§‡•ç‡§•‡§∞‡•ã‡§Ç ‡§∏‡•á, ‡§§‡•Å‡§Æ ‡§≠‡•Ä ‡§∞‡•Å‡§ï‡§®‡§æ ‡§®‡§æ ‡§Æ‡•Å‡§∂‡•ç‡§ï‡§ø‡§≤‡•ã‡§Ç ‡§∏‡•á, ‡§∏‡§™‡§®‡•á ‡§™‡•Ç‡§∞‡•á ‡§ï‡§∞‡•ã ‡§Ö‡§™‡§®‡•á‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
      <div class="shayari-card">
        <div class="shayari-text">‡§ú‡§ø‡§Ç‡§¶‡§ó‡•Ä ‡§ï‡•Ä ‡§™‡§∞‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§Æ‡•á‡§Ç ‡§™‡§æ‡§∏ ‡§π‡•ã‡§®‡§æ ‡§π‡•à, ‡§§‡•ã ‡§Ü‡§ú ‡§∏‡•á ‡§π‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞ ‡§¶‡•ã, ‡§∏‡§Æ‡§Ø ‡§¨‡•Ä‡§§ ‡§ú‡§æ‡§è‡§ó‡§æ ‡§ö‡•Å‡§™‡§ö‡§æ‡§™, ‡§´‡§ø‡§∞ ‡§™‡§õ‡§§‡§æ‡§®‡•á ‡§∏‡•á ‡§ï‡•Å‡§õ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡•á‡§ó‡§æ‡•§</div>
        <div class="shayari-author">- Guddu Sir, STUDY POINT Coaching</div>
      </div>
    </div>
  </div>

  <!-- Developer Contact Section -->
  <div class="developer-contact">
    <h3><i class="fas fa-laptop-code"></i> Website Developed By</h3>
    <p>For similar website development contact:</p>
    <div class="contact-info">
      <div class="contact-item">
        <i class="fas fa-phone"></i>
        <span>8580594404</span>
      </div>
      <div class="contact-item">
        <i class="fas fa-envelope"></i>
        <span>kk5674010@gmail.com</span>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <p>&copy; 2023 STUDY POINT COACHING CENTRE. All Rights Reserved.</p>
  </div>

  <!-- PDF Clone Container (Hidden) -->
  <div id="pdf-clone-container" class="pdf-clone-container"></div>

  <!-- JavaScript Code -->
  <script>
    // Firebase Configuration - Updated for STUDY POINT COACHING
    const firebaseConfig = {
      apiKey: "AIzaSyBDN5ATO_LQ-3THveZDGyvLjtjjavgTIJk",
      authDomain: "study-point-coaching-centre.firebaseapp.com",
      projectId: "study-point-coaching-centre",
      storageBucket: "study-point-coaching-centre.firebasestorage.app",
      messagingSenderId: "1044456595909",
      appId: "1:1044456595909:web:ca77701e20483dc640abac"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Global variables
    let allResults = [];
    let selectedExamId = null;
    let selectedExamData = null;
    let currentStudentResult = null;
    let newResults = []; // Track which results are "new"
    let viewedResults = []; // Track which results have been viewed

    // Admin password (updated as requested)
    const ADMIN_PASSWORD = "342523";

    // Load viewed results from localStorage
    function loadViewedResults() {
      const stored = localStorage.getItem('study_viewed_results');
      viewedResults = stored ? JSON.parse(stored) : [];
    }

    // Save viewed results to localStorage
    function saveViewedResults() {
      localStorage.setItem('study_viewed_results', JSON.stringify(viewedResults));
    }

    // Mark a result as viewed
    function markResultAsViewed(resultId) {
      if (!viewedResults.includes(resultId)) {
        viewedResults.push(resultId);
        saveViewedResults();
      }
    }

    // Check if a result is "new" (not viewed yet)
    function isResultNew(resultId) {
      return !viewedResults.includes(resultId);
    }

    // Open admin modal
    function openAdminModal() {
      document.getElementById('admin-modal').style.display = 'flex';
    }

    // Close admin modal
    function closeAdminModal() {
      document.getElementById('admin-modal').style.display = 'none';
      document.getElementById('admin-password').value = '';
    }

    // Check admin password
    function checkAdminPassword() {
      const password = document.getElementById('admin-password').value;
      if (password === ADMIN_PASSWORD) {
        window.location.href = "admin.html";
      } else {
        alert("Incorrect password! Please try again.");
        document.getElementById('admin-password').value = '';
        document.getElementById('admin-password').focus();
      }
    }

    // Fetch notice from Firebase
    async function fetchNotice() {
      try {
        const noticeSnapshot = await db.collection("notices").orderBy("timestamp", "desc").limit(1).get();
        if (!noticeSnapshot.empty) {
          const noticeData = noticeSnapshot.docs[0].data();
          const noticeText = noticeData.text || "üìö Admission is going on for 6th to 12th & Competitive Exams";
          
          // Create marquee content
          let marqueeHTML = '';
          for (let i = 0; i < 5; i++) {
            marqueeHTML += `<span>${noticeText} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>`;
          }
          document.getElementById('marquee-content').innerHTML = marqueeHTML;
        } else {
          // Default notice if no notice in Firebase
          const defaultNotice = "üìö Admission is going on for 6th to 12th & Competitive Exams";
          let marqueeHTML = '';
          for (let i = 0; i < 5; i++) {
            marqueeHTML += `<span>${defaultNotice} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>`;
          }
          document.getElementById('marquee-content').innerHTML = marqueeHTML;
        }
      } catch (error) {
        console.error("Error fetching notice:", error);
        // Fallback to default notice
        const defaultNotice = "üìö Admission is going on for 6th to 12th & Competitive Exams";
        let marqueeHTML = '';
        for (let i = 0; i < 5; i++) {
          marqueeHTML += `<span>${defaultNotice} &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</span>`;
        }
        document.getElementById('marquee-content').innerHTML = marqueeHTML;
      }
    }

    // Fetch about lines from Firebase
    async function fetchAboutLines() {
      try {
        const aboutSnapshot = await db.collection("about").orderBy("order").get();
        if (!aboutSnapshot.empty) {
          let aboutHTML = '';
          aboutSnapshot.forEach(doc => {
            const aboutData = doc.data();
            aboutHTML += `<li>${aboutData.text}</li>`;
          });
          document.getElementById('about-list').innerHTML = aboutHTML;
        } else {
          // Default about lines if none in Firebase
          const defaultAboutLines = [
            "STUDY POINT COACHING CENTRE ‡§è‡§ï ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ ‡§î‡§∞ ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§¶‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§® ‡§π‡•à‡•§",
            "‡§Ø‡§π‡§æ‡§Å ‡§™‡§¢‡§º‡§æ‡§à ‡§Ü‡§∏‡§æ‡§® ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•Ç‡§∞‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§∞‡§æ‡§à ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§",
            "‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ä ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§π‡§∞ ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§",
            "‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§∏‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§",
            "‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§",
            "‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§™‡§¢‡§º‡§æ‡§à ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¨‡•á‡§π‡§§‡§∞ ‡§Ü‡§§‡•á ‡§π‡•à‡§Ç‡•§",
            "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§∏‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§¨‡§¢‡§º‡§§‡§æ ‡§π‡•à‡•§",
            "‡§Ø‡§π‡§æ‡§Å ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ ‡§∏‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§"
          ];
          
          let aboutHTML = '';
          defaultAboutLines.forEach((line, index) => {
            aboutHTML += `<li>${line}</li>`;
          });
          document.getElementById('about-list').innerHTML = aboutHTML;
        }
      } catch (error) {
        console.error("Error fetching about lines:", error);
        // Fallback to default about lines
        const defaultAboutLines = [
          "STUDY POINT COACHING CENTRE ‡§è‡§ï ‡§≠‡§∞‡•ã‡§∏‡•á‡§Æ‡§Ç‡§¶ ‡§î‡§∞ ‡§ó‡•Å‡§£‡§µ‡§§‡•ç‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§¶‡•á‡§®‡•á ‡§µ‡§æ‡§≤‡§æ ‡§∏‡§Ç‡§∏‡•ç‡§•‡§æ‡§® ‡§π‡•à‡•§",
          "‡§Ø‡§π‡§æ‡§Å ‡§™‡§¢‡§º‡§æ‡§à ‡§Ü‡§∏‡§æ‡§® ‡§≠‡§æ‡§∑‡§æ ‡§Æ‡•á‡§Ç ‡§î‡§∞ ‡§™‡•Ç‡§∞‡•Ä ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§ï‡§∞‡§æ‡§à ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§",
          "‡§Ö‡§®‡•Å‡§≠‡§µ‡•Ä ‡§∂‡§ø‡§ï‡•ç‡§∑‡§ï ‡§π‡§∞ ‡§õ‡§æ‡§§‡•ç‡§∞ ‡§™‡§∞ ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ß‡•ç‡§Ø‡§æ‡§® ‡§¶‡•á‡§§‡•á ‡§π‡•à‡§Ç‡•§",
          "‡§®‡§ø‡§Ø‡§Æ‡§ø‡§§ ‡§ü‡•á‡§∏‡•ç‡§ü ‡§î‡§∞ ‡§Ö‡§≠‡•ç‡§Ø‡§æ‡§∏ ‡§∏‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•Ä ‡§§‡•à‡§Ø‡§æ‡§∞‡•Ä ‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§ï‡•Ä ‡§ú‡§æ‡§§‡•Ä ‡§π‡•à‡•§",
          "‡§ï‡§Æ‡§ú‡•ã‡§∞ ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡•á ‡§≤‡§ø‡§è ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§Æ‡§æ‡§∞‡•ç‡§ó‡§¶‡§∞‡•ç‡§∂‡§® ‡§¶‡§ø‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§",
          "‡§Ö‡§®‡•Å‡§∂‡§æ‡§∏‡§ø‡§§ ‡§µ‡§æ‡§§‡§æ‡§µ‡§∞‡§£ ‡§Æ‡•á‡§Ç ‡§™‡§¢‡§º‡§æ‡§à ‡§π‡•ã‡§®‡•á ‡§∏‡•á ‡§™‡§∞‡§ø‡§£‡§æ‡§Æ ‡§¨‡•á‡§π‡§§‡§∞ ‡§Ü‡§§‡•á ‡§π‡•à‡§Ç‡•§",
          "‡§≤‡§ï‡•ç‡§∑‡•ç‡§Ø-‡§Ü‡§ß‡§æ‡§∞‡§ø‡§§ ‡§™‡§¢‡§º‡§æ‡§à ‡§∏‡•á ‡§õ‡§æ‡§§‡•ç‡§∞‡•ã‡§Ç ‡§ï‡§æ ‡§Ü‡§§‡•ç‡§Æ‡§µ‡§ø‡§∂‡•ç‡§µ‡§æ‡§∏ ‡§¨‡§¢‡§º‡§§‡§æ ‡§π‡•à‡•§",
          "‡§Ø‡§π‡§æ‡§Å ‡§∂‡§ø‡§ï‡•ç‡§∑‡§æ ‡§ï‡•á ‡§∏‡§æ‡§• ‡§∏‡§Ç‡§∏‡•ç‡§ï‡§æ‡§∞ ‡§î‡§∞ ‡§Æ‡•á‡§π‡§®‡§§ ‡§ï‡§æ ‡§Æ‡§π‡§§‡•ç‡§µ ‡§∏‡§ø‡§ñ‡§æ‡§Ø‡§æ ‡§ú‡§æ‡§§‡§æ ‡§π‡•à‡•§"
        ];
        
        let aboutHTML = '';
        defaultAboutLines.forEach((line, index) => {
          aboutHTML += `<li>${line}</li>`;
        });
        document.getElementById('about-list').innerHTML = aboutHTML;
      }
    }

    // Fetch all results from Firestore (results collection)
    async function fetchAllResults() {
      try {
        loadViewedResults(); // Load previously viewed results
        
        const querySnapshot = await db.collection("results").get();
        allResults = [];
        newResults = []; // Reset new results array
        
        if (querySnapshot.empty) {
          document.getElementById("loading-results").innerHTML = 
            '<div class="error">No results available at the moment. Please check back later.</div>';
          return;
        }
        
        querySnapshot.forEach((doc) => {
          const data = doc.data();
          const resultId = doc.id;
          const isNew = isResultNew(resultId);
          
          if (isNew) {
            newResults.push(resultId);
          }
          
          allResults.push({
            id: resultId,
            examName: data.examName || "Unnamed Exam",
            createdAt: data.createdAt ? new Date(data.createdAt.toDate()).toLocaleDateString('en-IN', {
              day: 'numeric',
              month: 'long',
              year: 'numeric'
            }) : "Date not available",
            data: data,
            isNew: isNew
          });
        });
        
        // Sort by date (newest first)
        allResults.sort((a, b) => {
          return (b.data.createdAt?.toDate() || 0) - (a.data.createdAt?.toDate() || 0);
        });
        
        displayResultsList();
      } catch (error) {
        console.error("Error fetching results:", error);
        document.getElementById("loading-results").innerHTML = 
          '<div class="error">Error loading results. Please check your internet connection and try again.</div>';
      }
    }

    // Display results list
    function displayResultsList() {
      const resultsList = document.getElementById("results-list");
      const loading = document.getElementById("loading-results");
      
      if (allResults.length === 0) {
        loading.innerHTML = '<div class="error">No results available at the moment.</div>';
        return;
      }
      
      loading.style.display = "none";
      resultsList.style.display = "grid";
      
      let html = "";
      allResults.forEach((result, index) => {
        const newSticker = result.isNew ? '<div class="new-sticker">NEW</div>' : '';
        html += `
          <div class="result-item" onclick="selectExam('${result.id}', ${index})" id="result-item-${index}">
            ${newSticker}
            <div class="exam-name">${result.examName}</div>
            <div class="exam-date">üìÖ Published: ${result.createdAt}</div>
          </div>
        `;
      });
      
      resultsList.innerHTML = html;
    }

    // Select an exam
    function selectExam(examId, index) {
      selectedExamId = examId;
      selectedExamData = allResults[index].data;
      
      // Mark this result as viewed (remove NEW sticker)
      markResultAsViewed(examId);
      
      // Update the result item to remove NEW sticker
      const resultItem = document.getElementById(`result-item-${index}`);
      if (resultItem) {
        const newSticker = resultItem.querySelector('.new-sticker');
        if (newSticker) {
          newSticker.remove();
        }
      }
      
      // Highlight selected item
      document.querySelectorAll('.result-item').forEach(item => {
        item.classList.remove('active');
      });
      document.getElementById(`result-item-${index}`).classList.add('active');
      
      // Show roll number input section
      document.getElementById('selected-exam-name').textContent = 
        `Enter your Roll Number for: ${selectedExamData.examName}`;
      document.getElementById('results-list').style.display = 'none';
      document.getElementById('roll-input-section').style.display = 'block';
      document.getElementById('result-card').style.display = 'none';
      
      // Clear previous input
      document.getElementById('roll-input').value = '';
    }

    // Go back to results list
    function goBackToResults() {
      document.getElementById('results-list').style.display = 'grid';
      document.getElementById('roll-input-section').style.display = 'none';
      document.getElementById('result-card').style.display = 'none';
      selectedExamId = null;
      selectedExamData = null;
      currentStudentResult = null;
      
      // Remove active class
      document.querySelectorAll('.result-item').forEach(item => {
        item.classList.remove('active');
      });
    }

    // Calculate division based on percentage
    function calculateDivision(percentage) {
      if (percentage >= 60) {
        return {
          division: "FIRST DIVISION",
          color: "#28a745",
          bgColor: "#d4edda"
        };
      } else if (percentage >= 45) {
        return {
          division: "SECOND DIVISION",
          color: "#17a2b8",
          bgColor: "#d1ecf1"
        };
      } else if (percentage >= 30) {
        return {
          division: "THIRD DIVISION",
          color: "#ffc107",
          bgColor: "#fff3cd"
        };
      } else {
        return {
          division: "FAIL",
          color: "#dc3545",
          bgColor: "#f8d7da"
        };
      }
    }

    // Fetch student result
    function fetchStudentResult() {
      const rollInput = document.getElementById('roll-input').value.trim();
      
      if (!rollInput) {
        alert("Please enter your roll number");
        return;
      }
      
      if (!selectedExamData || !selectedExamData.students) {
        alert("Exam data not loaded properly. Please go back and select again.");
        return;
      }
      
      // Find student by roll number
      const student = selectedExamData.students.find(s => s.rollNo == rollInput);
      
      if (!student) {
        alert("Roll number not found in this exam. Please check your roll number and try again.");
        return;
      }
      
      // Display result
      displayStudentResult(student);
    }

    // Display student result
    function displayStudentResult(student) {
      currentStudentResult = student;
      
      // Hide input section, show result card
      document.getElementById('roll-input-section').style.display = 'none';
      const resultCard = document.getElementById('result-card');
      resultCard.style.display = 'block';
      
      // Set exam info
      document.getElementById('result-exam-name').textContent = selectedExamData.examName;
      
      // Set student info
      document.getElementById('result-student-name').textContent = student.name || "-";
      document.getElementById('result-father-name').textContent = student.fatherName || "-";
      document.getElementById('result-roll-no').textContent = student.rollNo || "-";
      
      // Calculate and display marks
      const marksTable = document.getElementById('marks-table-body');
      let html = '';
      let totalObtained = 0;
      let totalPossible = 0;
      
      if (student.marks && selectedExamData.subjects) {
        // Loop through subjects from exam data
        selectedExamData.subjects.forEach(subject => {
          const subjectName = subject.name;
          const subjectTotal = subject.total || 100;
          const marksObtained = student.marks[subjectName] || 0;
          const percentage = ((marksObtained / subjectTotal) * 100).toFixed(2);
          
          html += `
            <tr>
              <td>${subjectName}</td>
              <td>${marksObtained}</td>
              <td>${subjectTotal}</td>
              <td>${percentage}%</td>
            </tr>
          `;
          
          totalObtained += marksObtained;
          totalPossible += subjectTotal;
        });
        
        // Add total row
        const totalPercentage = totalPossible > 0 ? ((totalObtained / totalPossible) * 100).toFixed(2) : 0;
        html += `
          <tr class="total-marks">
            <td><strong>Total</strong></td>
            <td><strong>${totalObtained}</strong></td>
            <td><strong>${totalPossible}</strong></td>
            <td><strong>${totalPercentage}%</strong></td>
          </tr>
        `;
        
        document.getElementById('total-percentage').textContent = 
          `Total Percentage: ${totalPercentage}%`;
        
        // Calculate and display division
        const divisionInfo = calculateDivision(parseFloat(totalPercentage));
        const divisionElement = document.getElementById('division-display');
        divisionElement.textContent = `Division: ${divisionInfo.division}`;
        divisionElement.style.backgroundColor = divisionInfo.bgColor;
        divisionElement.style.color = divisionInfo.color;
        divisionElement.style.border = `2px solid ${divisionInfo.color}`;
        
      } else {
        html = '<tr><td colspan="4" style="text-align:center;">Marks data not available</td></tr>';
        document.getElementById('division-display').textContent = 'Division: N/A';
      }
      
      marksTable.innerHTML = html;
      
      // Scroll to result
      resultCard.scrollIntoView({ behavior: 'smooth' });
    }

    // Create clone for PDF generation
    function createPDFClone() {
      const resultCard = document.getElementById('result-card');
      const cloneContainer = document.getElementById('pdf-clone-container');
      
      // Clear previous clone
      cloneContainer.innerHTML = '';
      
      // Create a deep clone of the result card
      const clone = resultCard.cloneNode(true);
      clone.classList.add('pdf-clone');
      clone.style.display = 'block';
      clone.style.width = '100%';
      clone.style.maxWidth = '800px';
      clone.style.margin = '20px auto';
      clone.style.padding = '20px';
      clone.style.background = 'white';
      clone.style.boxShadow = '0 0 20px rgba(0,0,0,0.1)';
      clone.style.position = 'relative';
      clone.style.left = '0';
      clone.style.top = '0';
      clone.style.transform = 'none';
      clone.style.zIndex = '10001';
      
      // Remove action buttons from clone
      const actionButtons = clone.querySelector('.action-buttons');
      if (actionButtons) {
        actionButtons.remove();
      }
      
      // Show the clone container and add the clone
      cloneContainer.appendChild(clone);
      cloneContainer.style.visibility = 'visible';
      cloneContainer.style.opacity = '0';
      cloneContainer.style.pointerEvents = 'none';
      
      return clone;
    }

    // Preload all images in the result card
    function preloadImages(callback) {
      const images = document.querySelectorAll('#result-card img');
      let loadedCount = 0;
      const totalImages = images.length;
      
      if (totalImages === 0) {
        callback();
        return;
      }
      
      const onImageLoad = () => {
        loadedCount++;
        if (loadedCount === totalImages) {
          callback();
        }
      };
      
      images.forEach(img => {
        if (img.complete) {
          onImageLoad();
        } else {
          img.onload = onImageLoad;
          img.onerror = onImageLoad; // Also continue if image fails to load
        }
      });
    }

    // Download result as PDF - FIXED VERSION
    function downloadResultAsPDF() {
      // Disable the download button to prevent multiple clicks
      const downloadBtn = document.querySelector('.download-btn');
      const originalText = downloadBtn.innerHTML;
      downloadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating PDF...';
      downloadBtn.disabled = true;
      
      // Create a clone for PDF generation
      const clone = createPDFClone();
      const cloneContainer = document.getElementById('pdf-clone-container');
      
      // Show the clone container (but keep it invisible)
      cloneContainer.style.visibility = 'visible';
      cloneContainer.style.opacity = '0';
      
      // Wait a bit for DOM to settle
      setTimeout(() => {
        // Preload images before generating PDF
        preloadImages(() => {
          // Generate PDF with optimized settings
          const options = {
            margin: [10, 10, 10, 10],
            filename: `STUDY_POINT_Result_${currentStudentResult?.rollNo || 'unknown'}.pdf`,
            image: { 
              type: 'jpeg', 
              quality: 0.98 
            },
            html2canvas: { 
              scale: 2,
              useCORS: true,
              letterRendering: true,
              scrollX: 0,
              scrollY: 0,
              windowWidth: clone.scrollWidth,
              windowHeight: clone.scrollHeight,
              backgroundColor: '#ffffff',
              logging: false,
              onclone: function(clonedDoc) {
                // Ensure all images in clone are visible
                const clonedImages = clonedDoc.querySelectorAll('img');
                clonedImages.forEach(img => {
                  img.style.display = 'block';
                  img.style.maxWidth = '100%';
                  img.style.height = 'auto';
                });
              }
            },
            jsPDF: { 
              unit: 'mm', 
              format: 'a4', 
              orientation: 'portrait',
              compress: true
            },
            pagebreak: { 
              mode: ['avoid-all', 'css', 'legacy'],
              before: '.page-break-before',
              after: '.page-break-after',
              avoid: ['.no-break', 'tr', 'td']
            }
          };
          
          // Generate and save PDF
          html2pdf().set(options).from(clone).save().then(() => {
            // Cleanup: hide the clone container
            cloneContainer.style.visibility = 'hidden';
            cloneContainer.innerHTML = '';
            
            // Re-enable the download button
            downloadBtn.innerHTML = originalText;
            downloadBtn.disabled = false;
            
            // Show success message
            alert('PDF downloaded successfully!');
          }).catch(error => {
            console.error('PDF generation error:', error);
            cloneContainer.style.visibility = 'hidden';
            cloneContainer.innerHTML = '';
            
            // Re-enable the download button
            downloadBtn.innerHTML = originalText;
            downloadBtn.disabled = false;
            
            // Fallback: try simple method
            alert('Generating PDF... Please wait.');
            try {
              const fallbackOptions = {
                margin: 10,
                filename: `STUDY_POINT_Result_${currentStudentResult?.rollNo || 'unknown'}.pdf`,
                image: { type: 'jpeg', quality: 0.98 },
                html2canvas: { scale: 2, useCORS: true },
                jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
              };
              
              html2pdf().set(fallbackOptions).from(resultCard).save().then(() => {
                downloadBtn.innerHTML = originalText;
                downloadBtn.disabled = false;
              });
            } catch (fallbackError) {
              alert('Error generating PDF. Please try again or take a screenshot.');
              downloadBtn.innerHTML = originalText;
              downloadBtn.disabled = false;
            }
          });
        });
      }, 500);
    }

    // Initialize on page load
    document.addEventListener('DOMContentLoaded', function() {
      fetchAllResults();
      fetchNotice();
      fetchAboutLines();
      
      // Add event listener for Enter key in admin password field
      document.getElementById('admin-password').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          checkAdminPassword();
        }
      });
      
      // Add event listener for Enter key in roll input field
      document.getElementById('roll-input').addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          fetchStudentResult();
        }
      });
    });
  </script>
</body>
</html>
